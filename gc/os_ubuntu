FROM eclipse-temurin:17-jdk-focal as build

# work work work
WORKDIR /work

# Copy stuff
COPY ./Grasscutter Grasscutter
COPY ./VERSION .
COPY ./run.sh .

# Building Grasscutter Source
RUN ls Grasscutter -a && chmod +x run.sh && sh run.sh

FROM eclipse-temurin:17-jdk-focal
RUN  \
     # Install json utilities for config.json, net-tools for check ip config, git for resources (t3)
     apt-get update && apt-get --no-install-recommends install -y git npm net-tools && npm install -g json && apt-get autoremove && apt-get clean

# Sweet Home Alabama :)
WORKDIR /home

# EXPOSE Web (https) and Game Server
EXPOSE 443 22102

# Copy files Grasscutter
COPY --from=build /work/work ./Grasscutter
RUN ls Grasscutter -a

# Rock
COPY entrypoint.sh .
ENTRYPOINT ["sh", "entrypoint.sh"]